(()=>{"use strict";function e(){try{return"https://suportedti.agu.gov.br/otrs/index.pl?Action=AgentDashboard"==document.URL}catch(e){return!1}}function t(e){let t=e[0],n=e[1],o=t.split("/").reverse().join("-");return new Date(`${o} ${n} GMT-0300`)}function n(e){try{const t=document.getElementById("context-menu");Array.from(e.getElementsByTagName("tr")).forEach((e=>{function n(){console.log("chamou ",e),async function(e){try{if(!e.getAttribute("rdm-info")){const t=document.createElement("span");t.className="loader";const n=Array.from(e.getElementsByTagName("div")).find((e=>"Pendente da Mudança"===e.textContent));console.log(e,n),n.insertAdjacentElement("beforeend",t);const o=await async function(e){try{const t=await fetch(e),n=await t.text(),o=(new DOMParser).parseFromString(n,"text/html").querySelectorAll(".DataTable");return o[o.length-1].getElementsByTagName("span")[1].textContent}catch{}}(e.getElementsByTagName("a")[0].href);t.className="info",t.textContent=`: ${o}`}}catch{}}(e),e.setAttribute("rdm-info",!0),t.style.display="none"}function o(){t.style.display="none",document.removeEventListener("click",o)}e.addEventListener("contextmenu",(e=>{e.preventDefault(),document.querySelector("#load-rdm").onclick=n,t.style.left=`${e.clientX}px`,t.style.top=`${e.clientY+window.scrollY}px`,t.style.display="block",document.addEventListener("click",o)}))}))}catch{}}function o(){const o=function(e){let t=!1;for(let n=0;n<e.length;n++)try{e[n].getElementsByTagName("h2")[0]?.textContent.toString().includes("ConfigItem")&&(t=!0)}catch(e){console.log("icVerifier error: "+e)}return t}(document.querySelectorAll(".WidgetSimple .Header"));if(function(){try{return document.querySelector(".Headline").querySelector("h1").textContent.includes("Chamado#")}catch(e){}}()&&(setTimeout((()=>{!function(){const e=function(){let e=/([0-9]+)/i;const t=document.querySelector(".Headline").querySelector("h1").textContent,n=e.exec(t)[0];e=/([A-Za-z]+( [A-Za-z]+)+)/i;const o=document.querySelector(".UserAvatar").querySelector("div").textContent,a=e.exec(o)[0];return e=/—\s(.*)/i,{numChamado:n,tecName:a,userName:document.querySelectorAll(".FixedValueSmall")[4].title,userEmail:document.querySelectorAll(".FixedValueSmall")[6].title,subject:e.exec(t)[1]}}(),t=document.createElement("label");t.textContent="Teams:";const n=document.createElement("p");n.title="Link para conversa no Teams",n.className="Value FixedValueSmall";const o=document.createElement("a");let a;const c=(new Date).getHours();a=c>5&&c<12?"Bom dia":c<18?"Boa tarde":"Boa noite",o.href=`https://teams.microsoft.com/l/chat/0/0?users=${e.userEmail}&message=${a} Sr(a) ${e.userName}! Meu nome é ${e.tecName}, Técnico de Suporte da Empresa Hepta. O motivo do meu contato é referente ao Chamado ${e.numChamado}, com assunto: ${e.subject}.`,o.textContent="Conversar no Teams",o.target="_blank",n.insertAdjacentElement("afterbegin",o);const r=document.createElement("div");r.className="Clear";const l=document.getElementsByClassName("TableLike FixedLabelSmall Narrow");l[l.length-1].insertAdjacentElement("afterbegin",t),t.insertAdjacentElement("afterend",n),n.insertAdjacentElement("afterend",r)}()}),1e3),o||function(){const e=document.getElementsByTagName("body")[0],t=function(){try{const e=window.location.href.split("TicketID=")[1];return e.length>6?e.slice(0,6):e}catch(e){console.log(e)}}();e.insertAdjacentHTML("afterbegin",`\n    <a class="alert" title="Clique para adicionar o IC" href="https://suportedti.agu.gov.br/otrs/index.pl?Action=AgentLinkObject;SourceObject=Ticket;SourceKey=${t}" target="_blanck">\n        <div class="alert">\n            <h1 class="icon">!</h1>\n            <span class="span">\n                IC Não Associado!\n            </span>\n        </div>\n    </a>\n    `)}()),e){document.getElementsByTagName("body")[0].insertAdjacentHTML("beforeend",'\n    <div id="context-menu">\n    <ul>\n        <li id="load-rdm">Carregar estado da RDM</li>\n    </ul>\n    </div>\n    '),function(){try{const e=document.querySelector("#Dashboard9906-Chamados-Pendentes-box");n(e);const t=new MutationObserver((()=>{n(e)})),o={attributes:!0,childList:!0,subtree:!0};t.observe(e,o)}catch{}}();const e=function(){const e=new Date,n=document.getElementsByClassName("EventDetails"),o=[];for(let a=0;a<n.length;a++){const c=n[a].getElementsByClassName("Value");if(e.toLocaleDateString()==c[9].textContent.split(" ")[0]){const r=c[5].textContent,l=c[6].textContent,i=c[8].textContent.split(" ")[1],s=c[9].textContent.split(" ")[1],d=n[a].getAttribute("id").split("-")[2];let m=(t(i)-e)/1e3/60;if("Aguardando Validação"==r||"Em Atendimento"==r)break;if(m>15)break;o.push({estado:r,titulo:l,inicio:i,termino:s,link:d})}}return o.sort(((e,t)=>e.inicio.localeCompare(t.inicio)))}();e.length>0&&function(e){const t=document.getElementsByTagName("body")[0];let n=document.createElement("div"),o=document.createElement("div"),a=document.createElement("div"),c=document.createElement("h1"),r=document.createElement("img"),l=document.createElement("span"),i=document.createElement("div");t.appendChild(n),n.appendChild(o),n.appendChild(a),a.appendChild(c),a.appendChild(l),c.appendChild(r),n.setAttribute("class","alert events"),c.setAttribute("class","icon"),r.setAttribute("src","https://cdn-icons-png.flaticon.com/512/3652/3652191.png"),l.setAttribute("class","span"),l.innerHTML="Agendamentos",i.setAttribute("class","agendamentos"),a.setAttribute("class","footer"),o.setAttribute("class","container");for(let t=0;t<e.length;t++){let n=document.createElement("a"),o=document.createElement("div"),a=document.createElement("p"),c=document.createElement("p");n.setAttribute("class","evento"),n.setAttribute("href",`https://suportedti.agu.gov.br/otrs/index.pl?Action=AgentTicketZoom;TicketID=${e[t].link}`),n.setAttribute("target","_blanck"),o.setAttribute("class","horario"),n.appendChild(o),o.appendChild(a),o.appendChild(c),a.textContent=e[t].inicio,c.textContent=e[t].termino;let r=document.createElement("p"),l=document.createElement("p");n.appendChild(r),n.appendChild(l),r.textContent=e[t].titulo,l.textContent=e[t].estado,i.appendChild(n)}n.addEventListener("mouseenter",(()=>{o.appendChild(i)}),!1),n.addEventListener("mouseleave",(()=>{try{o.removeChild(i)}catch(e){console.log("Error: "+e)}}),!1)}(e)}}"loading"==document.readyState?document.addEventListener("DOMContentLoaded",o):o()})();